

    function saveDataToDb() {


      

    function saveDataToDb() {
           // Opzionale: prendi info utente
      const userRes = await fetch("https://discord.com/api/users/@me", {
        headers: { Authorization: `Bearer ${tokens.access_token}` },
      })
    
      const user = userRes.ok ? await userRes.json() : null
    
      console.log("UTENTE RECUPERATO", );
      // ── Qui decidi come gestire la sessione ──────────────────────
      // Opzione semplice: session ID random + salva token in memoria (o db)


      console.log("utente " + discordUser.username + " Registrato nel db");

      // 4. Crea sessione


    }


           // Opzionale: prendi info utente
      const userRes = await fetch("https://discord.com/api/users/@me", {
        headers: { Authorization: `Bearer ${tokens.access_token}` },
      })
    
      const user = userRes.ok ? await userRes.json() : null
    
      console.log("UTENTE RECUPERATO", );
      // ── Qui decidi come gestire la sessione ──────────────────────
      // Opzione semplice: session ID random + salva token in memoria (o db)

      const discordUser = await userRes.json() as {
        id: string
        username: string
        global_name: string | null
        avatar: string | null
        discriminator: string
        email: string | null
      };

      // 3. Salva / aggiorna utente (UPSERT)
      db.run(
        `INSERT INTO discord_users (id, username, global_name, avatar, discriminator, email)
        VALUES (?, ?, ?, ?, ?, ?)
        ON CONFLICT(id) DO UPDATE SET
          username = excluded.username,
          global_name = excluded.global_name,
          avatar = excluded.avatar`,
        [discordUser.id, discordUser.username, discordUser.global_name, discordUser.avatar, discordUser.discriminator, discordUser.email]
      );

      console.log("utente " + discordUser.username + " Registrato nel db");

      // 4. Crea sessione

      db.run(
        `INSERT INTO sessions (session_id, user_id, access_token, refresh_token, expires_at)
        VALUES (?, ?, ?, ?, ?)`,
        [
          sessionId,
          discordUser.id,
          tokens.access_token,
          tokens.refresh_token,
          Date.now() + tokens.expires_in * 1000
        ]
      );
    
    }
